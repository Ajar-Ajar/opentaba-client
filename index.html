<!DOCTYPE html>
<html>
<head>
	<title>תב"ע פתוחה</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.ie.css" /><![endif]-->
	<link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
	<link href="css/stylesheet.css" rel="stylesheet" media="screen">

</head>
<body>
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span8">
				<div id="map" style="height: 800px;"></div>
			</div>
			<div class="span4">
				<div id="right-bar" style="font-family: Alef; direction: rtl;">
					<div style="text-align: right;">
						<a href="#faqModal" role="button" class="btn" data-toggle="modal">מה זו תב"ע?</a>
					</div>
					<div id="header" style="text-align: center;">
						<h1><a href="javascript: window.location=window.location.pathname;">תב"ע פתוחה</a></h1>
					</div>
					<div id="info" style="text-align: right">
						<p>ברוך בואך לתב"ע הפתוחה!</p>
						<p>בחרו גוש במפה כדי לצפות בתוכניות הבניה</p>
						<p style="margin-top:80%">פרויקט תב"ע פתוחה נועד לאפשר גישה נוחה לצבור למידע על תוכניות בניה. הפרויקט בנוי בקוד פתוח, גם את ואתה יכולים לתרום, 
							<a href="https://github.com/niryariv/citymap-server">בצד השרת</a> או <a href="https://github.com/niryariv/citymap-client">הממשק</a>.<!--  ליצירת קשר, פנו ל niryariv@gmail.com --></p>
					</div>
				</div>
			</div>
		</div>
	</div>


	<div id="docModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="docModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="docModalLabel">צפיה במסמך</h3>
		</div>
		<div class="modal-body">
			<div id="modal-doc">עוד מעט..</div>
		</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">סגור</button>
			<a class="btn btn-primary" href="" target="_blank" id="doc_new_window"><i class="icon-zoom-in icon-white"></i> פתח בחלון חדש</a>
		</div>
	</div>

	
	<div id="faqModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="faqModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="faqModalLabel">מה זו תב"ע</h3>
		</div>
		<div class="modal-body" style="direction: rtl;">
			<!-- <iframe src="https://docs.google.com/document/d/1cPcegkJnFIuuYQC6GXPbdTMx_fsp8K7xEIl1xOcsHGI/pub?embedded=true"></iframe> -->
			<h4>מהי תב"ע? למה זה חשוב?</h4>
			<p>תב"ע, תכנית בניין עיר, היא מסמך חוקי שנערך על-ידי מתכנן, עובר תהליך אישור (שיפורט עוד מעט), ולאחר שהוא מאושר הוא הופך למעשה לחוק הקובע מה מותר לעשות בתחום התכנון והבנייה בשטח שעליו חלה התב"ע (יכול להיות בניין בודד, קבוצת בניינים, שכונה או עיר שלמה), ומה אסור. כוחה של התב"ע מוגדר בחוק התכנון והבנייה (נוסח מלא של החוק כאן או כאן) המינוח השגור "תכנית בניין עיר\ערים" מקורו בחוק הבריטי, וכיום ההתייחסות בחוק היא למינוח "תכנית" (קיימים מספר סוגים של תכניות. ההתייחסות ב-"תבע פתוחה" היא לתכניות מקומיות ומפורטות (ולא לתכניות מחוזיות או ארציות).</p>
			<p>התב"ע יכולה לקבוע, לדוגמה, כי בשטח מסוים מותר לבנות בניין, שגובהו 8 קומות, וחזיתו הקדמית צריכה להיות מרוחקת מהרחוב 5 מטרים, וצריכה להיות מצופה באבן. הבניין יהיה מיועד למגורים (כלומר זה מה שמותר לעשות בו), ושטח הדירות יהיה בין 80 לבין 140 מ"ר. אותה תב"ע יכולה לקבוע כי שטח (מגרש) סמוך, יהיה מיועד לגן ילדים ומותר יהיה לבנות מעליו טיפת חלב בתנאי שתהיה לה כניסה נפרדת, וכי, מגרש שלישי יהיה פארק.</p>
			<p>התב"ע, אם כך, משפיעה מאוד על חיינו - בניין חדש שנבנה, תוספת בנייה, חלק מפארק שנלקח לטובת כביש, או שכונה חדשה - כולם תוצאה של אישור תב"ע. חשוב לדעת כאשר תב"ע כלשהי נמצאת בתהליך אישור - כי יש לאזרח זמן מוגבל להשתתף בתהליך, ואחרי אישור התב"ע קשה הרבה יותר להשפיע - למנוע את בניית הבניין או להנמיך אותו, לשמור את הפארק, לוודא שיהיה בשכונה החדשה בית ספר וכולי. חשוב גם לדעת מה אומרת תב"ע שכבר אושרה, מפני שבין אישור התב"ע לבין הבנייה ישנו הליך נוסף - היתר הבנייה. ידיעת התב"ע נותנת לנו בקרה על הליך היתר הבנייה, ועל הבנייה עצמה.</p>
			<h4>מה כוללת תב"ע?</h4>
			<p>תב"ע כוללת שני מסמכים עיקריים - תשריט (מפה) ותקנון (הוראות). התשריט מסמן את השטח ומחלק אותו לאזורים (מגרשים) - כל מגרש צבוע בצבע אחר (ונושא מספר), והתקנון קובע מה מותר ומה אסור לעשות (ובעיקר לבנות) בכל צבע ובכל מגרש. התשריט כולל גם מפה של המצב הקיים - לפני אישור התב"ע, וגם של המצב אחרי אישורה - עם השינויים שהיא יוצרת - מפה זו נקראת "מצב מוצע".
			בנוסף, כולל התשריט פרטים חשובים כמו שטחי המגרשים, שם היזם והמתכנן, תאריכים וכולי. התקנון כולל פרטים רבים כגון הגדרות, דברי הסבר, טבלאות שטחים, שימושים מותרים בשטח וכולי. כדאי לקרוא את התקנון בעיון - זהו מסמך משפטי שיהפוך לחוק, וכל מילה חשובה.
			בנוסף, כוללת התב"ע נספחים. הנספחים קובעים פרטים חשובים כגון פרטי הבינוי. חלק מהנספחים מחייבים, וחלק מהם מנחים בלבד. לצערנו לא תמיד הנספחים נסרקים ומועלים לאינטרנט.</p>
			<p>זה מספר שנים שהתב"עות נערכות ומוגשות לפי נוהל קבוע - נוהל מבא"ת (מבנה אחיד לתכניות). לאחר שראיתם תכנית או שתיים הערוכות לפי נוהל מבא"ת, יהיה לכם די קל להבין מי נגד מי כאשר תראו תכנית נוספת.</p>

			<h4>מהו תהליך האישור?</h4>
			<p>היוזמה להכנת התב"ע היא בדרך כלל של היזם או בעל הקרקע - במקרה בו יזם קנה קרקע ורוצה לבנות עליה - או של גוף ממסדי - העירייה, משרד השיכון, מינהל מקרקעי ישראל  - במקרה של תכנון שכונה (או עיר). יזם התכנית פונה לשם הכנתה לאדריכל או מתכנן, שעורך את התכנית, לרוב באמצעות צוות רב תחומי. עורך התכנית מתייעץ עם העירייה כבר בשלב ההכנה של התכנית - כדי לקבל הנחיות ותנאים שהוא חייב לעמוד בהם.</p>
			<p>לאחר סיום התכנון, מוגשת התכנית לועדה המקומית לתכנון ובנייה. ועדה זו שוכנת ברוב המקרים בעירייה, ומורכבת מחברי מועצת העיר. הועדה דנה בתכנית לאחר שמתקבלות המלצות האגפים השונים בעירייה לגביה, ומחליטה מהי המלצתה לגבי התכנית. הועדה מעבירה את התכנית עם ההמלצה לועדה המחוזית לתכנון ובנייה. ראוי לציין כי ישנן תב"עות שבסמכותה של הועדה המקומית לאשר, אך אנו לא דנים באלו כאן.</p>
			<p>הועדה המחוזית דנה בתכנית, ומחליטה האם צריך לערוך בה שינויים, או שניתן להפקיד אותה להתנגדויות.לאחר ההחלטה על הפקדה, מופקדים עותקים של התב"ע במשרדי הועדה המקומית והמחוזית, לעיון הציבור ולהגשת התנגדויות. לפי חוק התכנון והבנייה רשאי להגיש התנגדות לתב"ע "כל מעונין בקרקע, בבנין או בכל פרט תכנוני אחר הרואה את עצמו נפגע". בנוסף, ישנה רשימה של גופים שאושרו על-ידי שר הפנים להגיש התנגדות בכל תכנית. ביניהם החברה להגנת הטבע, אגודת האדריכלים, אתרא קדישא, אדם טבע ודין ועוד. מיום ההפקדה (הכוללת גם תליית שלט באתר ופרסום בעיתונות - אלו הן אותן "הודעות בענייני תכנון ובנייה") ישנם חודשיים להגשת התנגדות, עם אפשרות להארכה. הגשת התנגדות כרוכה בתשלום אגרה</p>
			<p>טווח הזמן המוקצה להגשת התנגדות הוא 60 יום. לאחר תום התקופה (הניתנת להארכה ל-90 יום), דנה הועדה המחוזית בהתנגדויות. מגישי ההתנגדויות מוזמנים לפרט את טענותיהם בפני הועדה, והיא מחליטה לגבי כל התנגדות האם לקבלה, לקבל באופן חלקי, או לדחות לחלוטין. אם מוגשות התנגדויות רבות, הועדה ממנה "חוקר" שתפקידו לשמוע את ההתנגדויות ולהגיש את המלצותיו לועדה. לאחר הדיון בהתנגדויות תועבר התב"ע לתיקונים הנדרשים, ולאחר מכן הועדה תדון עליה שוב, ותחליט אם לאשר את התב"ע, או בז'רגון המקצועי "לתת לה תוקף".</p>
			<p>לאחר אישור התב"ע, על-מנת לפתוח בהליכי הבנייה ישנו שלב נוסף - היתר הבנייה. אך כאן המקום לציין כי במקרים רבים ישנן שתי תב"עות - תכנית מיתאר כללית, ותכנית מפורטת. רק על-סמך תכנית מפורטת (המינוח בתקנון הוא "תכנית הכוללת הוראות מפורטות") ניתן להוציא היתר בנייה.</p>
			<h4>היתר בנייה</h4>
			<p>היתר הבנייה הוא האישור הסופי אותו על היזם להשיג לפני הבנייה. גם אם התב"ע מאושרת, יש להוציא היתר בנייה על-מנת לבנות. ההיתר נשען על תב"ע, כלומר חייב למלא אחרי הוראותיה, אך הוא מפרט את הבנייה בצורה מדוייקת יותר, וכולל גם חומרי בנייה, תכניות אדריכליות ועוד. את היתר הבנייה מקבל היזם מהועדה המקומית, וגם בהליך זה ישנה חובה ליידע את הציבור, אך לא באמצעות פרסום בעיתון, אלא על-ידי משלוח הודעות לבעלי החלקות הסמוכות.</p>
		</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">סגור</button>
		</div>
	</div>

	<script src="http://cdn.leafletjs.com/leaflet-0.4/leaflet.js"></script>
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	
	<script src="lib/bootstrap/js/bootstrap.min.js"></script>
	<script src="lib/pdfobject.js"></script>
	<script src="lib/path.js"></script>

	<script src="data/gushim.js"></script>

	<script>

		var RUNNING_LOCAL = (document.location.host == 'localhost' || document.location.host == '127.0.0.1')

		var API_URL = RUNNING_LOCAL ? 'http://0.0.0.0:5000/' : 'http://enigmatic-peak-9169.herokuapp.com/';
		
		function show_data(url){
			if (url.indexOf('.pdf', url.length - 4) !== -1) { // endsWith('.pdf')?
				new PDFObject({ url: url }).embed("modal-doc");
			} else {
				$("#modal-doc").html('<iframe src="' + url + '"></iframe>');
			}

			$("#doc_new_window").attr("href", url);
			$("#docModal").modal().css({ width: '90%', height: '80%', 'margin-left': function () { return -($(this).width() / 2); } });
		}

		function render_plans(plans) {
			var out = '<h3 style="color: grey;">גוש ' + plans[0].gush_id + '</h3>';

			// html brought to you courtsey of 1998
			out += "<table>";
			for (var i = 0 ; i<plans.length ; i++) {
				p = plans[i];

				//plan_link = 'http://www.mmi.gov.il/IturTabot/taba2.asp?Gush=' + p.gush_id + '&MisTochnit=' + escape(p.number)
				plan_link = 'http://mmi.gov.il/IturTabot/taba4.asp?kod=3000&MsTochnit=' + escape(p.number)
				
				out+='<tr style="vertical-align:top" class="item">' +
					 '	<td><b>' + [p.day, p.month, p.year].join('/') + '</b></td>' +
					 '	<td>' + p.status  + '</td>'+
					 '	<td><b>' + p.essence + '</b></td>'+
					 '</tr>' +
					 '<tr class="details">' +
					 '	<td colspan="2">' +
					 '		<a href="' + plan_link + '" target="_blank" rel="tooltip" title="פתח באתר ממי"><!-- i class="icon-share"></i -->'+
					 '		תוכנית ' + p.number + '</a>' +
					 '	</td>' +
					 '	<td>';

				for (var j=0 ; j<p.tasrit_link.length ; j++)
					out += '<a onclick="show_data('+ "'" + p.tasrit_link[j] + "')" + 
							'" rel="tooltip" title="תשריט"><i class="icon-globe"></i></a>'

				for (var j=0 ; j<p.takanon_link.length ; j++)
					out += '<a onclick="show_data('+ "'" + p.takanon_link[j] + "')" + 
							'" rel="tooltip" title="תקנון"><i class="icon-file"></i></a>'
		
				for (var j=0 ; j<p.nispahim_link.length ; j++)
					out += '<a onclick="show_data('+ "'" + p.nispahim_link[j] + "')" + 
							'" rel="tooltip" title="נספחים"><i class="icon-folder-open"></i></a>'

				for (var j=0 ; j<p.files_link.length ; j++)
					out += '<a href="http://mmi.gov.il' + p.files_link[j] + 
							'" rel="tooltip" title="קבצי ממג"><i class="icon-download-alt"></i></a>'
					
				out+='	</td>'  +
					 '</tr>' 	+
					 '<tr style="height: 10px"><td colspan="3">&nbsp;</td></tr>';
			}
			out += '</table>';

			$("#info").html(out);

			// activate Boostrap tooltips on attachment icons
			$("[rel='tooltip']").tooltip({'placement' : 'bottom'});


			$(".item").hover(
	  			function () { $(this).css("background","#fff"); $(this).next(".details").css("background","#fff"); }, //#f7f7f9
	  			function () { $(this).css("background","")	  ; $(this).next(".details").css("background",""); }
			);

			$(".details").hover(
	  			function () { $(this).css("background","#fff"); $(this).prev(".item").css("background","#fff"); },
	  			function () { $(this).css("background","")	  ; $(this).prev(".item").css("background",""); }
			);


			// $(".item").click(
	  		//		function () { $(this).next().toggle(); }
			// );

		}

		function get_gush(gush_id) {
			$.getJSON(
				API_URL + 'gush/' + gush_id + '/plans',
				function(d) { render_plans(d); }
			)
		}

		function onEachFeature(feature, layer) {
			layer.bindPopup(feature.properties.Name + " גוש ");
			layer.on({
						'mouseover'	: function() { this.setStyle({ opacity: 0 	, color: "red" 	}) },
						'mouseout'	: function() { this.setStyle({ opacity: 0.95, color: "#777" }) },
						'click'		: function() { 
							$("#info").html("עוד מעט..."); 
							location.hash = "#/gush/" + feature.properties.Name;
							// get_gush(feature.properties.Name);
						}
					});
		}

		// jQuery startup funcs
		$(document).ready(function(){

			// wake up possibly-idling heroku dyno to make sure later requests aren't too slow
			$.getJSON( API_URL + "wakeup" , function(){/* do nothing */})

			// setup a path.js router to allow distinct URLs for each block
			Path.map("#/gush/:gush_id").to(
				function(){ 
					$("#docModal").modal('hide');
					get_gush(this.params['gush_id']); 
				}
			);
			Path.listen();
		});

		var map = L.map('map', { scrollWheelZoom: false }).setView([31.765, 35.17], 13);

		tile_url = 'http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png';
		L.tileLayer(tile_url, {
			maxZoom: 18,
		}).addTo(map);

		L.geoJson(gushim,
			{
				onEachFeature: onEachFeature,
				style : {
					"color" : "#777",
					"weight": 1,
					"opacity": 0.9
				}
			}
		).addTo(map);

	</script>
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-37675804-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
</body>
</html>
<!- Jerusalem, winter 2013 -->